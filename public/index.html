<!doctype html>
<html>
</head>
<title>Hello, Snaps!</title>
<link rel="icon" type="image/svg" href="./images/icon.svg" />
</head>

<body>
  <h1>Hello, Snaps!</h1>
  <details>
    <summary>Instructions</summary>
    <ul>
      <li>First, click "Connect". The extension menu should open and show that the connection succeeded.</li>
      <li>After the menu closes, open the extension menu again,
        <br>click on  your account avatar > Setting > Snaps and see the installed snap.
        <br>The status should be 'installed'. Also, the status in the extension's menu should be 'connected'.
      </li>
    </ul>
  </details>
  <br />

  <button class="connect">Connect</button>
  <button class="sendHello">Send Hello</button>
  <button class="starknet">starknet keyPair</button>
</body>

<script>
  const snapId = `npm:@metamask/template-snap`;

  const connectButton = document.querySelector('button.connect')
  const sendButton = document.querySelector('button.sendHello')
  const starknetButton = document.querySelector('button.starknet')

  connectButton.addEventListener('click', connect)
  sendButton.addEventListener('click', send)
  starknetButton.addEventListener('click', starknetKeyPair)

  // here we get permissions to interact with and install the snap
  async function connect() {
    await ethereum.request({
      method: 'wallet_enable',
      params: [{
        wallet_snap: { [snapId]: {} },
      }]
    })
  }

  // here we call the snap's "hello" method
  async function send() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'hello'
        }]
      })
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }

  async function starknetKeyPair() {
    try {
      const response = await ethereum.request({
        method: 'wallet_invokeSnap',
        params: [snapId, {
          method: 'getKeyPair'
        }]
      })
    } catch (err) {
      console.error(err)
      alert('Problem happened: ' + err.message || err)
    }
  }
</script>

</html>